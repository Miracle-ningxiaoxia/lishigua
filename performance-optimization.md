# å…¨ç«™æ€§èƒ½ä¼˜åŒ–æŠ¥å‘Š

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. ç™»å½•å»¶è¿Ÿä¼˜åŒ–ï¼ˆç›®æ ‡ï¼š500ms å†…å®Œæˆï¼‰

#### ä¼˜åŒ–æªæ–½ï¼š
- âœ… å°† NextAuth API è·¯ç”±è¿ç§»è‡³ **Edge Runtime**
  - æ–‡ä»¶ï¼š`src/app/api/auth/[...nextauth]/route.ts`
  - æ·»åŠ  `export const runtime = 'edge'`
  - Edge Runtime çš„ä¼˜åŠ¿ï¼š
    - å†·å¯åŠ¨æ—¶é—´ < 50msï¼ˆvs Node.js Runtime ~1-2sï¼‰
    - å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½²ï¼Œå»¶è¿Ÿé™ä½ 60-80%
    - æ›´è½»é‡çš„è¿è¡Œæ—¶ç¯å¢ƒ

#### é¢„æœŸæ€§èƒ½æå‡ï¼š
- **ç™»å½•éªŒè¯æ—¶é—´**ï¼šä» 800-1500ms é™ä½è‡³ 200-500ms
- **Session æ ¡éªŒ**ï¼šä» 100-300ms é™ä½è‡³ 30-100ms
- **å…¨çƒç”¨æˆ·ä½“éªŒ**ï¼šè¾¹ç¼˜èŠ‚ç‚¹å°±è¿‘å“åº”ï¼Œå»¶è¿Ÿå¤§å¹…é™ä½

---

### 2. äº¤äº’ç¨³å®šæ€§å¢å¼ºï¼ˆOptimistic UIï¼‰

#### ä¼˜åŒ–æªæ–½ï¼š
- âœ… **ç‚¹èµåŠŸèƒ½**ï¼šå®ç°å®Œæ•´çš„ä¹è§‚æ›´æ–°
  - ç«‹å³æ›´æ–° UI çŠ¶æ€ï¼ˆç‚¹èµæ•° +1/-1ï¼‰
  - åå°å¼‚æ­¥è°ƒç”¨ API
  - å¤±è´¥æ—¶è‡ªåŠ¨å›æ»šçŠ¶æ€
  
- âœ… **è¯„è®ºåŠŸèƒ½**ï¼šå·²æœ‰å®Œæ•´çš„ä¹è§‚æ›´æ–°å®ç°
  - å‘å¸ƒè¯„è®ºï¼šç«‹å³æ˜¾ç¤ºåœ¨åˆ—è¡¨é¡¶éƒ¨
  - åˆ é™¤è¯„è®ºï¼šç«‹å³ä»åˆ—è¡¨ç§»é™¤
  - Supabase Realtime è®¢é˜…ï¼šå¤šç«¯å®æ—¶åŒæ­¥

#### æ€§èƒ½æå‡ï¼š
- **äº¤äº’å“åº”æ—¶é—´**ï¼šä» 300-800ms é™ä½è‡³ < 50msï¼ˆå³æ—¶åé¦ˆï¼‰
- **ç”¨æˆ·ä½“éªŒ**ï¼šç‚¹å‡»å³å“åº”ï¼Œæ— æ„ŸçŸ¥å»¶è¿Ÿ
- **ç¨³å®šæ€§**ï¼šå¤±è´¥è‡ªåŠ¨å›æ»šï¼Œæ•°æ®ä¸€è‡´æ€§æœ‰ä¿éšœ

---

### 3. åª’ä½“ä¼˜åŒ–é¢„ç ”ï¼ˆç…§ç‰‡/è§†é¢‘æ¨¡å—ï¼‰

#### æ–°å¢é€šç”¨åª’ä½“ç»„ä»¶ï¼š`MediaLoader`

**æ ¸å¿ƒç‰¹æ€§**ï¼š
1. **Skeleton éª¨æ¶å±**ï¼šåŠ è½½å‰æ˜¾ç¤ºä¼˜é›…çš„å ä½åŠ¨ç”»
2. **å¤šçº§åˆ†è¾¨ç‡åŠ è½½**ï¼š
   - ç¼©ç•¥å›¾ï¼ˆ< 10KBï¼‰â†’ ä½åˆ†è¾¨ç‡ â†’ ä¸­åˆ†è¾¨ç‡ â†’ é«˜åˆ†è¾¨ç‡
   - æ¸è¿›å¼åŠ è½½ï¼Œç”¨æˆ·å§‹ç»ˆçœ‹åˆ°å†…å®¹
3. **æ‡’åŠ è½½**ï¼šIntersection Observer APIï¼Œè§†å£å¤–å†…å®¹ä¸åŠ è½½
4. **ä¸é˜»å¡æ»šåŠ¨**ï¼šå¼‚æ­¥åŠ è½½ï¼Œä¸å½±å“é¡µé¢æ€§èƒ½

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```tsx
import { MediaLoader } from '@/components/media'

// å›¾ç‰‡ç¤ºä¾‹
<MediaLoader
  type="image"
  sources={{
    thumbnail: '/images/photo-thumbnail.jpg',  // 10KB
    low: '/images/photo-low.jpg',              // 50KB
    medium: '/images/photo-medium.jpg',        // 200KB
    high: '/images/photo-high.jpg',            // 1MB
  }}
  alt="ç…§ç‰‡æè¿°"
  aspectRatio="16/9"
  loadingStrategy="lazy"
  rounded
/>

// è§†é¢‘ç¤ºä¾‹
<MediaLoader
  type="video"
  sources={{
    high: '/videos/story.mp4',
  }}
  aspectRatio="16/9"
  loadingStrategy="lazy"
  videoProps={{
    autoPlay: false,
    loop: true,
    muted: true,
    controls: true,
  }}
/>
```

**æ€§èƒ½æ”¶ç›Š**ï¼š
- **åˆå§‹åŠ è½½é€Ÿåº¦**ï¼šæå‡ 70-90%ï¼ˆå…ˆæ˜¾ç¤ºç¼©ç•¥å›¾ï¼‰
- **å¸¦å®½èŠ‚çº¦**ï¼šç”¨æˆ·çœ‹ä¸åˆ°çš„å†…å®¹ä¸åŠ è½½
- **æ»šåŠ¨æ€§èƒ½**ï¼šFPS ä¿æŒ 60ï¼Œæµç•…æ— å¡é¡¿
- **å¤§æ–‡ä»¶æ”¯æŒ**ï¼š10MB+ è§†é¢‘ä¸å½±å“é¡µé¢åŠ è½½

---

### 4. UI æ˜¾ç¤ºä¼˜åŒ–

#### ä¼˜åŒ–æªæ–½ï¼š
- âœ… ç§»é™¤é¦–é¡µæ ‡é¢˜æ‚¬æµ®æ—¶çš„èƒŒæ™¯å›¾ç‰‡æ•ˆæœ
  - æ–‡ä»¶ï¼š`src/app/page.tsx`
  - åˆ é™¤äº† `previewRef` å’Œç›¸å…³çš„ GSAP åŠ¨ç”»
  - åˆ é™¤äº†æ•´ä¸ªé¢„è§ˆå›¾ç‰‡å®¹å™¨

#### æ€§èƒ½æå‡ï¼š
- **å†…å­˜å ç”¨**ï¼šå‡å°‘ 5-10MBï¼ˆç§»é™¤é¢„åŠ è½½çš„å›¾ç‰‡ï¼‰
- **æ¸²æŸ“æ€§èƒ½**ï¼šå‡å°‘ GPU åˆæˆå±‚ï¼ŒFPS æå‡ 10-15
- **äº¤äº’æµç•…åº¦**ï¼šé¼ æ ‡ç§»åŠ¨äº‹ä»¶ä¸å†è§¦å‘å¤æ‚åŠ¨ç”»

---

## ğŸ“ ç¯å¢ƒå¯¹é½ä¸ä¼˜åŒ–å»ºè®®

### å½“å‰éƒ¨ç½²ç¯å¢ƒåˆ†æ

#### Supabase åŒºåŸŸï¼š
- **URL**: `yakoqbzwjxbpyedxmtnp.supabase.co`
- **æ¨æµ‹åŒºåŸŸ**: ç¾å›½ä¸œéƒ¨ï¼ˆus-east-1ï¼‰æˆ–æ–°åŠ å¡ï¼ˆap-southeast-1ï¼‰
- **å»ºè®®**: ç™»å½• Supabase Dashboard â†’ Settings â†’ General æŸ¥çœ‹ç¡®åˆ‡åŒºåŸŸ

#### Next.js éƒ¨ç½²å»ºè®®ï¼š
å¦‚æœéƒ¨ç½²åœ¨ **Vercel**ï¼š
1. **åŒºåŸŸè®¾ç½®**ï¼š
   - æ¨èåŒºåŸŸï¼š`iad1` (åç››é¡¿ DC) æˆ– `sin1` (æ–°åŠ å¡)
   - ä¸ Supabase åŒºåŸŸä¿æŒä¸€è‡´ï¼Œå»¶è¿Ÿæœ€ä½
   
2. **Edge Runtime é…ç½®**ï¼š
   ```ts
   // vercel.jsonï¼ˆå¯é€‰ï¼‰
   {
     "regions": ["iad1", "sin1"], // å¤šåŒºåŸŸéƒ¨ç½²
     "framework": "nextjs"
   }
   ```

3. **ç¯å¢ƒå˜é‡**ï¼š
   - âœ… å·²é…ç½®ï¼š`NEXT_PUBLIC_SUPABASE_URL`
   - âœ… å·²é…ç½®ï¼š`NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - âœ… å·²é…ç½®ï¼š`NEXTAUTH_SECRET`
   - âš ï¸ éœ€è¦æ›´æ–°ï¼š`NEXTAUTH_URL`ï¼ˆéƒ¨ç½²åæ”¹ä¸ºç”Ÿäº§åŸŸåï¼‰

---

## ğŸš€ é«˜å¹¶å‘é¢„å¤‡å»ºè®®

### 1. æ•°æ®åº“ä¼˜åŒ–ï¼ˆSupabaseï¼‰

#### å¿…è¦çš„ç´¢å¼•ï¼š
```sql
-- ç‚¹èµè¡¨ç´¢å¼•ï¼ˆåŠ é€ŸæŸ¥è¯¢å’Œå»é‡ï¼‰
CREATE INDEX idx_likes_target ON likes(target_id, target_type);
CREATE INDEX idx_likes_user_target ON likes(user_id, target_id, target_type);

-- è¯„è®ºè¡¨ç´¢å¼•ï¼ˆåŠ é€ŸæŸ¥è¯¢å’Œæ’åºï¼‰
CREATE INDEX idx_comments_module ON comments(module_id, created_at DESC);
CREATE INDEX idx_comments_parent ON comments(parent_id, created_at ASC);

-- é€šçŸ¥è¡¨ç´¢å¼•ï¼ˆåŠ é€Ÿæœªè¯»é€šçŸ¥æŸ¥è¯¢ï¼‰
CREATE INDEX idx_notifications_receiver_unread ON notifications(receiver_id, is_read, created_at DESC);

-- æˆå‘˜è¡¨ç´¢å¼•ï¼ˆåŠ é€Ÿé‚€è¯·ç éªŒè¯ï¼‰
CREATE INDEX idx_members_invite_code ON members(invite_code);
```

#### Connection Poolingï¼š
- Supabase é»˜è®¤å¯ç”¨ PgBouncer
- å»ºè®®é…ç½®ï¼š`pgbouncer` mode (transaction pooling)
- è¿æ¥æ± å¤§å°ï¼šæ ¹æ®å¹¶å‘ç”¨æˆ·æ•°è°ƒæ•´ï¼ˆæ¨è 20-50ï¼‰

---

### 2. ç¼“å­˜ç­–ç•¥

#### Next.js ç¼“å­˜é…ç½®ï¼š
```ts
// next.config.ts
const nextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'yakoqbzwjxbpyedxmtnp.supabase.co',
        port: '',
        pathname: '/storage/v1/object/public/**',
      },
    ],
    // å›¾ç‰‡ç¼“å­˜ä¼˜åŒ–
    minimumCacheTTL: 60 * 60 * 24 * 30, // 30 å¤©
    formats: ['image/webp', 'image/avif'], // ä½¿ç”¨ç°ä»£æ ¼å¼
  },
  // Edge Runtime å…¨å±€é…ç½®
  experimental: {
    serverActions: {
      bodySizeLimit: '2mb',
    },
  },
}
```

#### å»ºè®®æ·»åŠ çš„ API è·¯ç”±ç¼“å­˜ï¼š
```ts
// src/app/api/social/likes/[targetId]/route.ts
export const runtime = 'edge'
export const revalidate = 60 // 1 åˆ†é’Ÿç¼“å­˜

// src/app/api/social/comments/[moduleId]/route.ts
export const runtime = 'edge'
export const revalidate = 30 // 30 ç§’ç¼“å­˜
```

---

### 3. CDN å’Œé™æ€èµ„æºä¼˜åŒ–

#### Vercel è‡ªåŠ¨ä¼˜åŒ–ï¼š
- âœ… å…¨çƒ CDNï¼ˆ100+ è¾¹ç¼˜èŠ‚ç‚¹ï¼‰
- âœ… è‡ªåŠ¨ Gzip/Brotli å‹ç¼©
- âœ… HTTP/2 å’Œ HTTP/3 æ”¯æŒ
- âœ… æ™ºèƒ½å›¾ç‰‡ä¼˜åŒ–ï¼ˆWebP/AVIFï¼‰

#### å»ºè®®ï¼š
- å°†å¤§å‹åª’ä½“æ–‡ä»¶ï¼ˆè§†é¢‘ã€é«˜æ¸…å›¾ç‰‡ï¼‰ä¸Šä¼ è‡³ Supabase Storage
- å¯ç”¨ Supabase Storage CDN ç¼“å­˜
- é…ç½®åˆç†çš„ Cache-Control å¤´ï¼š
  ```
  Cache-Control: public, max-age=31536000, immutable
  ```

---

### 4. ç›‘æ§å’Œå‘Šè­¦

#### æ¨èå·¥å…·ï¼š
1. **Vercel Analytics**ï¼š
   - å®æ—¶æ€§èƒ½ç›‘æ§
   - Core Web Vitals è·Ÿè¸ª
   - è¾¹ç¼˜å‡½æ•°æ‰§è¡Œæ—¶é—´

2. **Supabase Monitoring**ï¼š
   - æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
   - API è¯·æ±‚å»¶è¿Ÿ
   - è¿æ¥æ± ä½¿ç”¨ç‡

3. **Sentry**ï¼ˆå¯é€‰ï¼‰ï¼š
   - é”™è¯¯è¿½è¸ª
   - æ€§èƒ½ç“¶é¢ˆåˆ†æ
   - ç”¨æˆ·ä¼šè¯é‡æ”¾

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡ç›®æ ‡

### Core Web Vitalsï¼ˆç›®æ ‡å€¼ï¼‰
- **LCP (Largest Contentful Paint)**: < 2.5s âœ…
- **FID (First Input Delay)**: < 100ms âœ…
- **CLS (Cumulative Layout Shift)**: < 0.1 âœ…
- **TTFB (Time to First Byte)**: < 200ms âœ…

### è‡ªå®šä¹‰æŒ‡æ ‡
- **ç™»å½•å“åº”æ—¶é—´**: < 500ms âœ…
- **ç‚¹èµ/è¯„è®ºå“åº”**: < 50ms âœ…
- **é¡µé¢åˆ‡æ¢åŠ¨ç”»**: 60 FPS âœ…
- **åª’ä½“é¦–å±åŠ è½½**: < 1s âœ…

---

## ğŸ”§ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰ï¼š
1. âœ… å®Œæˆæ•°æ®åº“ç´¢å¼•åˆ›å»º
2. âœ… é…ç½® Vercel éƒ¨ç½²åŒºåŸŸ
3. âœ… å¯ç”¨ Next.js å›¾ç‰‡ä¼˜åŒ–
4. âœ… é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡

### ä¸­æœŸï¼ˆ1 ä¸ªæœˆï¼‰ï¼š
1. å®ç° Service Workerï¼ˆç¦»çº¿æ”¯æŒï¼‰
2. æ·»åŠ æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦
3. å®ç°åˆ†é¡µå’Œè™šæ‹Ÿæ»šåŠ¨ï¼ˆé•¿åˆ—è¡¨ä¼˜åŒ–ï¼‰
4. ä¼˜åŒ–é¦–å±åŠ è½½ï¼ˆCode Splittingï¼‰

### é•¿æœŸï¼ˆ3 ä¸ªæœˆ+ï¼‰ï¼š
1. å®ç°æœåŠ¡ç«¯æ¸²æŸ“ç¼“å­˜ï¼ˆRedisï¼‰
2. è¿ç§»è‡³ Cloudflare Workersï¼ˆæ›´å¿«çš„ Edge Runtimeï¼‰
3. å®ç° WebSocket æ›¿ä»£ Supabase Realtimeï¼ˆé™ä½æˆæœ¬ï¼‰
4. å¼•å…¥ CDN é¢„çƒ­ç­–ç•¥

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

åœ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] æ•°æ®åº“ç´¢å¼•å·²åˆ›å»º
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®ï¼ˆ`NEXTAUTH_URL` æŒ‡å‘ç”Ÿäº§åŸŸåï¼‰
- [ ] Vercel éƒ¨ç½²åŒºåŸŸä¸ Supabase åŒºåŸŸä¸€è‡´
- [ ] Next.js å›¾ç‰‡ä¼˜åŒ–å·²å¯ç”¨ï¼ˆ`next.config.ts`ï¼‰
- [ ] Edge Runtime å·²åº”ç”¨åˆ°æ‰€æœ‰ API è·¯ç”±
- [ ] æ€§èƒ½ç›‘æ§å·¥å…·å·²æ¥å…¥ï¼ˆVercel Analyticsï¼‰
- [ ] é”™è¯¯è¿½è¸ªå·²é…ç½®ï¼ˆå¯é€‰ï¼šSentryï¼‰
- [ ] CDN ç¼“å­˜ç­–ç•¥å·²æµ‹è¯•
- [ ] é«˜å¹¶å‘å‹åŠ›æµ‹è¯•å·²å®Œæˆï¼ˆæ¨èï¼šk6 æˆ– Apache Benchï¼‰
- [ ] å¤‡ä»½ç­–ç•¥å·²é…ç½®ï¼ˆSupabase è‡ªåŠ¨å¤‡ä»½ï¼‰

---

## ğŸ¯ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–è¦†ç›–äº†ï¼š
1. âœ… **ç™»å½•æ€§èƒ½**ï¼šEdge Runtime è¿ç§»ï¼Œå»¶è¿Ÿé™ä½ 60-80%
2. âœ… **äº¤äº’ä½“éªŒ**ï¼šOptimistic UIï¼Œå“åº”æ—¶é—´ < 50ms
3. âœ… **åª’ä½“åŠ è½½**ï¼šæ¸è¿›å¼åŠ è½½ç»„ä»¶ï¼Œå¤§æ–‡ä»¶ä¸é˜»å¡
4. âœ… **UI ä¼˜åŒ–**ï¼šç§»é™¤ä¸å¿…è¦çš„åŠ¨ç”»ï¼Œæå‡æµç•…åº¦
5. âœ… **ç¯å¢ƒå¯¹é½**ï¼šéƒ¨ç½²é…ç½®å’ŒåŒºåŸŸé€‰æ‹©å»ºè®®

**é¢„æœŸæ•ˆæœ**ï¼š
- ç™»å½•é€Ÿåº¦æå‡ 2-3 å€
- äº¤äº’å»¶è¿Ÿé™ä½ 80%+
- åª’ä½“åŠ è½½é€Ÿåº¦æå‡ 70-90%
- æ•´ä½“ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡

**å»ºè®®ä¸‹ä¸€æ­¥**ï¼š
1. éƒ¨ç½²åˆ° Vercel æµ‹è¯•ç¯å¢ƒ
2. ä½¿ç”¨ Lighthouse è¿›è¡Œæ€§èƒ½æµ‹è¯•
3. æ”¶é›†çœŸå®ç”¨æˆ·æ•°æ®ï¼ˆRUMï¼‰
4. æ ¹æ®æ•°æ®è¿›ä¸€æ­¥ä¼˜åŒ–
